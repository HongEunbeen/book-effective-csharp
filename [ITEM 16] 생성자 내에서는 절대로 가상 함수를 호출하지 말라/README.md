## 생성자 내 가상함수

생성자가 수행을 완료할 때가지 객체는 완전히 생성되었다고 할 수 없습니다.

생성자 내에서 가상 함수를 호출하게되면 예상대로 동작하지 않습니다.

### [상속 관계에서의 문제]

```csharp
class B
{
	protected B() { Func(); }
	protected virtual void Func() { Console.WriteLine("BBB"); }
}
class A : B
{
	public A() { }
	protected override void Func() { Console.WriteLine("AAA"); }
	public static void Main() { var d = new A("Constructed in main"); }
}

```

- 부모 클래스 A : 생성자 내에서 자기 클래스에 정의된 가상 함수 호출
- 자식 클래스 B : 가상 함수를 재정의

런타임에서는 자식 클래스가 가상 함수를 이미 재정의 하고 있기 때문에 AAA가 먼저 출력됩니다.

C#는 생성자의 본문으로 들어가는 순간 해당 객체는 이미 초기화가 완료된 것으로 간주합니다.

즉, 런타임에 객체의 타입이 A입니다.

### [생성자에서 가상함수를 호출해도 되는 유일한 경우]

자식 클래스가 기본 생성자만을 정의하고 있고, 다른 어떤 생성자도 가지고 있지 않은 경우입니다.

하지만 이렇게 된다면 자식 클래스를 정의하는 과정에 심각한 제약이 발생합니다.

## 정리

- 생성자 내에서 가상 함수를 호출 시 올바르게 동작할 가능성이 거의 없으므로 사용하지 말아야 합니다.
