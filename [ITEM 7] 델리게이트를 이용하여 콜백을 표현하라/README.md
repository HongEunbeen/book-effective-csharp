## 콜백

콜백은 서버가 클라이언트에게 비동기적으로 피드백을 주기 위해서 주로 사용하는 방법입니다.
이를 위해 멀티스레딩 기술도 사용되고, 동기적으로 상태를 갱신하는 기법도 할용됩니다.
C#에서는 델리게이트를 이용해 표현합니다.

## 델리게이트

델리게이트를 이용하면 타입 안정적인 콜백을 정의할 수 있습니다.

**클래스 간의 결합도 낮춤**

여러 클래스가 상호 통신을 수행해야 할 때 클래스 간의 결합도를 낮추고 싶다면 인터페이스보다 델리케이트를 사용하는 것이 좋습니다.
델리게이트는 런타임에 통지 대상을 설정하고, 다수의 클라이언트에게 통지를 보낼 수 있습니다.
또한, 하나의 델리게이트는 여러 메서드에 대한 참조를 포함할 수 있습니다.

죽, 델리게이트를 사용하면 통지를 전달하려는 대상이 런타임에 구성하기에 따라 달라집니다.

## C#에서의 콜백과 델리게이트

- `Predicate<T>` : 조건을 검사하여 부울값을 반환하는 델리게이트
- `Action<>` :  여러 개의 매개변수를 받지만 반환 타입이 void인 델리게이트
- `Func<>` : 여러 개의 매개변수를 받아 단일의 결괏값을 반환하는 델리게이트
- `Func<T, bool>` `Predicate<T>` : 같은 타입입니다.

일반적으로 동일한 타입의 매개변수를 취해도 반환 타입이 다른 경우 서로 다른 델리게이트라고 간주합니다.

이에 따라 컴파일러는 이 둘 사이의 형변환을 허용하지 않습니다.

`List<T>`에서 사용하는 콜백 메서드

- `Find()` : Predicate<int> 형식의 델리게이트(콜백)을 사용해 각 항목을 테스트하며, 테스트를 통과한 항목만을 반환합니다.
- `TureForAll()` : 개별적으로 각 요소를 테스트 후 모든 항목이 테스트를 통과한 경우에만 true를 반환합니다.
- `ForEach()` : 리스트 내의 각 요소에 대해 델리게이트로 지정한 동작 수행 후 람다 표현식을 메서드로 반호나 후 이 메서드를 참조하는 델리게이트를 생성합니다.

## LINQ

LINQ는 모두 델리게이트를 기반으로 합니다. 

## 단일 메서드

매개변수로 단일 메서드를 필요로 하는 모든 경우에 람다 표현식을 쓸 수 있도록 델리게이트를 사용하고 동일한 구조의 API를 직접 만드는 경우에도 가능한 한 이와 유사한 방식으로 작성하는 것이 좋습니다.

## 멀티캐스트

모든 델리게이트는 멀티캐스트가 가능합니다.

멀티캐스트 델리게이트는 한 번만 호출하면 델리게이트 객체에 추가된 모든 대상 함수가 호출됩니다.

## 멀티캐스트의 단점

**예외에 안전하지 않음**

멀티캐스트 델리게이트의 내부 동작 방식은 함수를 연속적으로 호출하는 형태로 구현됭기에 어떤 예외도 잡지 않으며, 예외가 발생하면 함수 호출 과정이 중단됩니다.

**호출된 대상 함수의 반환값이 델리게이트의 반환값으로 간주됨**

델리게이트의 반환값은 멀티캐스트 체인에서 마지막으로 호출된 함수의 반환값이 되며, 다른 반환값은 모두 부시됩니다.

단점을 해결하기 위해선 델리게이트에 포함된 호출 대상 콜백 함수를 직접 다뤄야 합니다.

즉, 델리게이트는 추가된 메서드의 리스트를 가지므로, 리스트를 살펴서 직접 호출하는 방식으로 코드를 작성해야 합니다.

## 정리

델리게이트는 런타임에 콜백을 구성하는 최고의 방법입니다.

- 콜백을 사용해야 하는 클라이언트를 더욱 단순하게 구성할 수 있음
- 런타임에 콜백 함수를 구성할 수 있음
- 하나의 델리게이트에 여러 개의 콜백 함수를 추가할 수 있음

.NET 환경에서 콜백이 필요한 경우에는 반드시 델리게이트를 사용해야 합니다.
