## 초기화 코드 중복 방지

다양한 방법으로 코드가 중복되는 것을 방지하고 더 효율적으로 수행되는 생성자를 작성할 수 있습니다.

### [공용 생성자]

C# 컴파일러는 공용 생성자를 이용하는 초기화 방식을 매우 특별한 문법으로 인식합니다.

객체 초기화를 위해 수행해야 하는 코드를 최적화 해줍니다.

변수에 대한 중복 초기화 코드를 제거하며 부모 클래스의 생성자가 반복적으로 호출되는 것을 막아줍니다.

```csharp
public class MyClass
{
	private List<ImportantData> coll;
	private string name;
	public MyClass() : this(5) {}
	public MyCkass(int initialCount) { this.initalCount = initialCount; }
}
```

생성자를 이용해 멤버 변수의 값을 초기화 한다면 다른 생성자를 호출해 초기화 과정의 일부를 위임할 수도 있습니다.

### [C# 4.0 기본 매개변수 기능 활용]

```csharp
public class MyClass
{
	private List<ImportantData> coll;
	private string name;
	public MyClass() : this(5) {}
	public MyCkass(int initialCount = 0) { this.initalCount = initialCount; }
}
```

클래스 내에 있는 여러 개의 생성자를 기본값이 가진 매개변수로 취하면 생성자를 하나로 대체할 수 있습니다.

- 기본값을 갖는 매개변수는 사용자에게 더 많은 옵션을 제공합니다.
- 생성자의 모든 매개변수에 대해서 기본값을 정의한 경우 new MyClass()라고만 작성해도 유효한 코드가 됩니다.

주의 사항도 있습니다.

- new() 제약 조건을 명시한 제네릭 클래스와 함께 사용해야 할 경우 기본값을 가지는 매개변수를 취하는 생성자마능로는 제약 조건을 만족시킬 수 없습니다.
- 초기화 타입을 사용하는 코드와의 결합도가 높아집니다.

## 초기화 코드 기본값

컴파일 타임 상수가 아닌 string.Empty으로는 기본값 지정이 불가합니다.

매개변수의 기본값으로는 컴파일타임 상수만 지정할 수 있습니다.

## 생성자 : 기본값 가지는 매개변수 vs 다수의 생성자 오버로딩

일반적으로 여러 개의 생성자를 오버로딩하기보다는 기본값을 가지는 매개변수를 사용해 생성자를 작성하는 것이 좋습니다.

매개변수의 기본값은 합리적으로 지정돼야 하고 예외를 유발해서는 안 됩니다.

## C#의 객체 초기화 과정

인스턴스가 생성되는 동안 모든 멤버 변수들을 가능한 한 한 번만 초기화하도록 해야합니다.

이를 위해서는 초기화를 가능한 한 이른 시점에 수행하는 방식이 좋습니다.

### [특정 타입으로 첫 번째 인스턴스를 생성할 떄 수행되는 과정]

1. 정적 변수의 저장 공간을 0으로 초기화
2. 정적 변수에 대한 초기화 구문 수행
3. 부모 클래스의 정적 생성자 수행
4. 정적 생성자 수행
5. 인스턴스 변수의 저장 공간을 0으로 초기화
6. 인스턴스 변수에 대한 조기화 구문 수행
7. 적절한 부모 클래스의 인스턴스 생성자 수행
8. 인스턴스 생성자 수행

이때, 클래스 자체에 대한 초기화 작업(1~4)는 단 한 번만 이루어 집니다.

죽, 추가 인스턴스가 생성되면 5단계부터 수행됩니다.

또한, 컴파일러가 생성자 내 중복된 멤버 초기화 코드를 생성하지 않도록 6,7 단계는 최적화 되어 있습니다.

## 정리

- C#은 객체가 생성될 떄 어떤 식으로든 모든 객체가 초기화될 것임을 보장합니다.
- 인스턴스를 생성하면 인스턴스 내의 모든 멤버들이 최소한 0으로 초기화 됩니다. (정적, 인스턴스 모두)
- 생성자를 작성할 때는 멤버들을 원하는 값으로 가능한 한 번만 초기화가 이뤄지도록 해야 합니다.
    
    → 단순한 리소스의 경우 : 멤버 초기화 구분을 이용합니다.
    
    → 복잡한 초기화 구문이 필요한 경우 : 생성자를 이용합니다.
    
- 코드의 중복을 피하기 위해 공통적인 초기화 작업을 수행하는 공용 생성자를 작성하고 이용합니다.
